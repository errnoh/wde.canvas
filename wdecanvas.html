<canvas id="wdecanvas" width="100", height="100"></canvas>

<script type="text/javascript">
/*
http://www.javascripture.com/Uint8ClampedArray
http://beej.us/blog/data/html5s-canvas-2-pixel/
http://www.w3schools.com/jsref/dom_obj_event.asp
http://www.quirksmode.org/js/events_mouse.html
http://www.quirksmode.org/dom/events/index.html
*/


// Fullscreen ikkuna, onresize listener lähettää eventchanille infoa?

// newWindow(w,h) = 
// createsocket?
// setSize(window.innerWidth, window.innerHeight)
// luo RGBA bufferi

var element = document.getElementById("wdecanvas");
var c = element.getContext("2d");

var locked = false;

function setSize(width, height) {
    if (!locked) {
        canvas1.width = width;
        canvas1.height = height;
    }
}

function size() {
    return [canvas1.width, canvas1.height];
}

function lockSize(bool) {
    locked = bool;
}

function title(s) {
    document.title = s;
}

function flush(arr) {
    imageData = c.createImageData(element.width, element.height);
    imageData.data.set(arr, 0);
    // copy the image data back onto the canvas
    c.putImageData(imageData, 0, 0); // at coords 0,0
}

function close() {

}

/*
    NewWindow(width, height int) (Window, error)

    // Jos sockettia ei olemassa niin mitä?

    SetTitle(title string)                              // Go -> JS
    SetSize(width, height int)                          // Go -> JS
    Size() (width, height int)                          // JS -> Go ?
    LockSize(lock bool)                                 // Go -> JS (noop?)
    Show()                                              // ? [parhaimmillaan avaisi CEF ikkunan] 
                                                        // vs avaa browser osoitteeseen ja odota sockettiyhteyttä.
    FlushImage(bounds ...image.Rectangle)               // Go -> JSON Array -> JS
    EventChan() (events <-chan interface{})             // JS -> Go
    Close() (err error)                                 // ?
    Screen() (im Image)                                 // Go
        CopyRGBA(src *image.RGBA, bounds image.Rectangle)
        Set(x, y int, c color.Color)                    // Go
        ColorModel() color.Model                        // Go
        Bounds() Rectangle                              // Go
        At(x, y int) color.Color                        // Go
*/

/*
CloseEvent
KeyDownEvent
KeyEvent
KeyTypedEvent
KeyUpEvent
MouseButtonEvent
MouseDownEvent
MouseDraggedEvent
MouseEnteredEvent
MouseEvent
MouseExitedEvent
MouseMovedEvent
MouseUpEvent
ResizeEvent
*/

// http://www.quirksmode.org/js/events_mouse.html
// http://www.w3schools.com/jsref/dom_obj_event.asp

wdecanvas.onclick = function(e) {
    e.preventDefault();
}

wdecanvas.oncontextmenu = function(e) {
    e.preventDefault();
}

wdecanvas.onmousewheel = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Where = new Object();
    ev.Where.X = e.offsetX;
    ev.Where.Y = e.offsetY;
    if (e.wheelDeltaY >= 0) {
        ev.Which = 8;
    } else {
        ev.Which = 16;
    }
}

wdecanvas.onmousedown = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Where = new Object();
    ev.Which = 1 << e.button;
    ev.Where.X = e.offsetX;
    ev.Where.Y = e.offsetY;   
}

wdecanvas.onmouseup = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Where = new Object();
    ev.Which = 1 << e.button;
    ev.Where.X = e.offsetX;
    ev.Where.Y = e.offsetY;   
}

// Addeventlistener?
window.onresize = function(e) {
    var ev = new Object();
    ev.Width = window.innerWidth;
    ev.Height = window.innerHeight;
}

// Pitäisikö lähettää esim 50ms välein tj? Tulee kauhea spammi kun joka pikseli on oma event.
// Tallentaisi aina edellisen sijainnin 50ms sitten ja lähettäisi muutoksen seuraavan eventin yhteydessä.
wdecanvas.onmousemove = function(e) {
    e.preventDefault();
    //console.log(e.offsetX + " " + e.offsetY);
    // ev.Where, ev.From?
}

// TODO: Mousedraggedevent? mousedown point alku, 50ms välein mousemove sijainteja ja mouseup kohdalla viimeinen?

window.onkeyup = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Which = e.which; 
}

window.onkeydown = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Which = e.which;
}

window.onkeypress = function(e) {
    e.preventDefault();
}

wdecanvas.onmouseover = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Where = new Object();
    ev.Where.X = e.offsetX;
    ev.Where.Y = e.offsetY; 
    // ev.From?
}

wdecanvas.onmouseout = function(e) {
    e.preventDefault();
    var ev = new Object();
    ev.Where = new Object();
    ev.Where.X = e.offsetX;
    ev.Where.Y = e.offsetY;
    // ev.From?
}

</script>
